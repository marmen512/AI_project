# üîÑ –ö–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–æ –∑ checkpoint'—ñ–≤

## –©–æ —Ç–∞–∫–µ checkpoint?

Checkpoint - —Ü–µ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —Å—Ç–∞–Ω –Ω–∞–≤—á–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ, —è–∫–∏–π –≤–∫–ª—é—á–∞—î:
- –°—Ç–∞–Ω –º–æ–¥–µ–ª—ñ (–≤–∞–≥–∏)
- –°—Ç–∞–Ω optimizer
- –°—Ç–∞–Ω scheduler
- –ü–æ—Ç–æ—á–Ω—É –µ–ø–æ—Ö—É —Ç–∞ —ñ–Ω–¥–µ–∫—Å –±–∞—Ç—á—É
- –°—Ç–∞–Ω EMA –º–æ–¥–µ–ª—ñ

## –Ø–∫ –ø—Ä–∞—Ü—é—î checkpoint —Å–∏—Å—Ç–µ–º–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è

Checkpoint'–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è:
- **–ü–µ—Ä—ñ–æ–¥–∏—á–Ω–æ:** –∫–æ–∂–Ω—ñ N –±–∞—Ç—á—ñ–≤ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∫–æ–∂–Ω—ñ 100 –±–∞—Ç—á—ñ–≤)
- **–§—ñ–Ω–∞–ª—å–Ω–æ:** –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –Ω–∞–≤—á–∞–Ω–Ω—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ checkpoint —Ñ–∞–π–ª—ñ–≤

```
checkpoints/
‚îú‚îÄ‚îÄ checkpoint_latest.pt          # –û—Å—Ç–∞–Ω–Ω—ñ–π checkpoint (–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ)
‚îú‚îÄ‚îÄ checkpoint_epoch_1_batch_50.pt   # –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π checkpoint
‚îú‚îÄ‚îÄ checkpoint_epoch_2_batch_150.pt
‚îî‚îÄ‚îÄ checkpoint_final.pt           # –§—ñ–Ω–∞–ª—å–Ω–∏–π checkpoint –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
```

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### 1. –ó–∞–ø—É—Å–∫ –Ω–∞–≤—á–∞–Ω–Ω—è –∑ checkpoint'–∞–º–∏

**–û—Å–Ω–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç (OpenAssistant –¥–∞—Ç–∞—Å–µ—Ç):**
```bash
python scripts/train_model.py \
    --dataset datasets/train/openassistant_train.json \
    --checkpoint-dir checkpoints \
    --checkpoint-interval 100 \
    --epochs 15
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç (–¥–ª—è –∫–æ–¥—É):**
```bash
python train/train_code_model.py \
    --data phi3_training_dataset.json \
    --save trm_optimized.pt \
    --checkpoint-dir checkpoints \
    --checkpoint-interval 100 \
    --epochs 20
```

### 2. –ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –Ω–∞–≤—á–∞–Ω–Ω—è –ø—ñ—Å–ª—è –ø–µ—Ä–µ—Ä–≤–∏

–Ø–∫—â–æ –Ω–∞–≤—á–∞–Ω–Ω—è –±—É–ª–æ –ø–µ—Ä–µ—Ä–≤–∞–Ω–æ, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ checkpoint:

**–û—Å–Ω–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç:**
```bash
python scripts/train_model.py \
    --dataset datasets/train/openassistant_train.json \
    --resume checkpoints/checkpoint_latest.pt \
    --checkpoint-dir checkpoints
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç:**
```bash
python train/train_code_model.py \
    --data phi3_training_dataset.json \
    --save trm_optimized.pt \
    --resume checkpoints/checkpoint_latest.pt \
    --checkpoint-dir checkpoints
```

### 3. –ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ checkpoint

```bash
python scripts/train_model.py \
    --dataset datasets/train/openassistant_train.json \
    --resume checkpoints/checkpoint_epoch_5_batch_200.pt \
    --checkpoint-dir checkpoints
```

## –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏

### ‚ö†Ô∏è –£–≤–∞–≥–∞!

1. **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –º–æ–¥–µ–ª—ñ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ:**
   - `--dim`
   - `--depth`
   - `--seq-len`
   - `--batch-size`
   
   –Ø–∫—â–æ —Ü—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è –≤—ñ–¥ —Ç–∏—Ö, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏—Å—å –ø—ñ–¥ —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è checkpoint, –Ω–∞–≤—á–∞–Ω–Ω—è –Ω–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

2. **–î–∞—Ç–∞—Å–µ—Ç –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ —Ç–æ–π —Å–∞–º–∏–π:**
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç–æ–π —Å–∞–º–∏–π `--data` —Ñ–∞–π–ª
   - –ü–æ—Ä—è–¥–æ–∫ –¥–∞–Ω–∏—Ö –º–æ–∂–µ –±—É—Ç–∏ —ñ–Ω—à–∏–º (—á–µ—Ä–µ–∑ shuffle), –∞–ª–µ —Ü–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ

3. **Learning rate —Ç–∞ —ñ–Ω—à—ñ –≥—ñ–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∏:**
   - –ë—É–¥—É—Ç—å –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω—ñ –∑ checkpoint
   - –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–∞–∑—É–≤–∞—Ç–∏ `--lr` –ø—Ä–∏ resume (–∞–ª–µ –º–æ–∂–Ω–∞, —è–∫—â–æ —Ö–æ—á–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏)

### ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ checkpoint'—ñ–≤

1. **–ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –Ω–∞–≤—á–∞–Ω–Ω—è:** –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ä–≤–∞—Ç–∏ —Ç–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ
2. **–ë–µ–∑–ø–µ–∫–∞:** –ù–µ –≤—Ç—Ä–∞—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å –ø—Ä–∏ –∞–≤–∞—Ä—ñ–π–Ω–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ñ
3. **–ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏:** –ú–æ–∂–Ω–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É
4. **–ï–∫–æ–Ω–æ–º—ñ—è —á–∞—Å—É:** –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ—á–∏–Ω–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è –∑ –ø–æ—á–∞—Ç–∫—É

### üìä –Ø–∫ —á–∞—Å—Ç–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ checkpoint'–∏?

- **`--checkpoint-interval 50`** - —á–∞—Å—Ç—ñ—à–µ (–±—ñ–ª—å—à–µ –º—ñ—Å—Ü—è –Ω–∞ –¥–∏—Å–∫—É)
- **`--checkpoint-interval 100`** - –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (–±–∞–ª–∞–Ω—Å)
- **`--checkpoint-interval 500`** - —Ä—ñ–¥—à–µ (–µ–∫–æ–Ω–æ–º—ñ—è –º—ñ—Å—Ü—è)

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ: **100-200 –±–∞—Ç—á—ñ–≤** –¥–ª—è –±–∞–ª–∞–Ω—Å—É –º—ñ–∂ –±–µ–∑–ø–µ–∫–æ—é —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –¥–∏—Å–∫—É.

## –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª –Ω–∞–≤—á–∞–Ω–Ω—è –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

```bash
# 1. –ü–æ—á–∞—Ç–æ–∫ –Ω–∞–≤—á–∞–Ω–Ω—è
python scripts/train_model.py \
    --dataset datasets/train/openassistant_train.json \
    --checkpoint-dir checkpoints \
    --checkpoint-interval 100 \
    --epochs 15

# –Ø–∫—â–æ –ø–µ—Ä–µ—Ä–≤–∞–Ω–æ (Ctrl+C –∞–±–æ –ø–æ–º–∏–ª–∫–∞), –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏:

# 2. –ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –Ω–∞–≤—á–∞–Ω–Ω—è
python scripts/train_model.py \
    --dataset datasets/train/openassistant_train.json \
    --resume checkpoints/checkpoint_latest.pt \
    --checkpoint-dir checkpoints \
    --checkpoint-interval 100 \
    --epochs 15
```

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ checkpoint'—ñ–≤

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—è–≤–Ω—ñ checkpoint'–∏

```bash
ls -lh checkpoints/
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–º—ñ—Å—Ç checkpoint'—É (Python)

```python
import torch

checkpoint = torch.load('checkpoints/checkpoint_latest.pt')
print(f"–ï–ø–æ—Ö–∞: {checkpoint['epoch']}")
print(f"–ë–∞—Ç—á: {checkpoint['batch_idx']}")
print(f"–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±–∞—Ç—á—ñ–≤: {checkpoint['batch_count']}")
```

## –í–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö checkpoint'—ñ–≤

–©–æ–± –∑–≤—ñ–ª—å–Ω–∏—Ç–∏ –º—ñ—Å—Ü–µ –Ω–∞ –¥–∏—Å–∫—É, –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç–∞—Ä—ñ checkpoint'–∏, –∑–∞–ª–∏—à–∏–≤—à–∏ –ª–∏—à–µ –æ—Å—Ç–∞–Ω–Ω—ñ–π:

```bash
# –ó–∞–ª–∏—à–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ latest —Ç–∞ final
cd checkpoints
ls -t | tail -n +3 | xargs rm -f
```

---

**üí° –ü–æ—Ä–∞–¥–∞:** –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `--checkpoint-dir` –¥–ª—è –¥–æ–≤–≥–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è. –¶–µ –∑–∞–æ—â–∞–¥–∏—Ç—å –≤–∞—à —á–∞—Å —É —Ä–∞–∑—ñ –ø—Ä–æ–±–ª–µ–º!

